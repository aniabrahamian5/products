$.ajaxSetup({
    headers: {
        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
    },
});
if ($("#payment-form").length != 0) {
    var payment_form = new DatPayment({
        form_selector: "#payment-form",
        card_container_selector: ".dpf-card-placeholder",
        number_selector: '.dpf-input[data-type="number"]',
        date_selector: '.dpf-input[data-type="expiry"]',
        cvc_selector: '.dpf-input[data-type="cvc"]',
        name_selector: '.dpf-input[data-type="name"]',

        submit_button_selector: ".dpf-submit",

        placeholders: {
            number: "•••• •••• •••• ••••",
            expiry: "••/••",
            cvc: "•••",
            name: "Name on card",
        },

        validators: {
            number: function (number) {
                return Stripe.card.validateCardNumber(number);
            },
            expiry: function (expiry) {
                var expiry = expiry.split(" / ");
                return Stripe.card.validateExpiry(
                    expiry[0] || 0,
                    expiry[1] || 0
                );
            },
            cvc: function (cvc) {
                return Stripe.card.validateCVC(cvc);
            },
            name: function (value) {
                return value.length > 0;
            },
        },
    });
}

function setshippings(x) {
    var price = $(x).attr("data-payment");
    var placetype = $(x).attr("data-ups");
    $("#shipping_price").html("$" + price);
    var all = $("#prod-total").html().split("$")[1];
    var all_price =
        parseFloat(all) +
        parseFloat(price) +
        parseFloat($("#tax_price").attr("data-val")) +
        parseFloat($("#expedite_price").attr("data-val"));
    $("#all_price").html("$" + all_price.toFixed(2));
    $("#place_type").val(placetype);
}
function setshippingsonly(x) {
    var placetype = $(x).attr("data-ups");
    $("#place_type").val(placetype);
}
function nulltax() {
    $("#tax_price").html("$0");
    $("#tax_price").attr("data-val", "0");
    var all = $("#prod-total").html().split("$")[1];
    var price = $("#shipping_price").html().split("$")[1];
    var all_price =
        parseFloat(all) +
        parseFloat(price) +
        parseFloat($("#tax_price").attr("data-val")) +
        parseFloat($("#expedite_price").attr("data-val"));
    $("#all_price").html("$" + all_price.toFixed(2));
}
function gotopayment() {
    var number_cart = $("#cart-number").val();
    var expiry = $("#expiry").val().replace("/", "_");
    var cvc = $("#cvc").val();
    var name_surname = $("#name_surname").val();
    var address_id = $(".address_id").val();
    if ($("#cart-number").hasClass("visa")) {
        var cart_type = "visa";
    } else if ($("#cart-number").hasClass("mastercard")) {
        var cart_type = "mastercard";
    } else if ($("#cart-number").hasClass("discover")) {
        var cart_type = "discover";
    } else if ($("#cart-number").hasClass("amex")) {
        var cart_type = "amex";
    }
    if (
        $("#cart-number").hasClass("jp-card-valid") &&
        $("#expiry").hasClass("jp-card-valid") &&
        $("#cvc").hasClass("jp-card-valid") &&
        $("#name_surname").hasClass("jp-card-valid")
    ) {
        $(".error-message1").hide();
        document.getElementById("btn-checkout").style.cursor = "wait";
        document.getElementById("btn-checkout").disabled = true;
        $.post(
            "/cabinet/addcard/" +
                cart_type +
                "/" +
                number_cart +
                "/" +
                expiry +
                "/" +
                cvc +
                "/" +
                name_surname +
                "/" +
                address_id,
            "json",
            function (data) {
                if (data != 0) {
                    if (data == "Error! This card already added.") {
                        $(".error-message1").find("strong").html(data);
                        $(".error-message1").show();
                    } else {
                        location.reload();
                    }
                }
                document.getElementById("btn-checkout").style.cursor =
                    "pointer";
                document.getElementById("btn-checkout").disabled = false;
            }
        );
    } else {
        $(".error-message1").show();
    }
}
function addTocartnew(product_id) {
    console.log(4);
    
    if (
        $("#quantity-cart-" + product_id).attr("max") <
        $("#quantity-cart-" + product_id).val()
    ) {
        $("#quantity-cart-" + product_id).val(
            $("#quantity-cart-" + product_id).attr("max")
        );
        $("#quantity-cart-" + product_id)
            .parent()
            .find(".text-danger")
            .removeClass("hide");
    } else {
        var qty = $("#quantity-cart-" + product_id).val();
        var group_id = $("#group_id").val();
        if (qty != 0) {
            $.post(
                "/cart/edit/" + product_id + "/" + qty + "/" + group_id,
                "json",
                function (data) {
                    if (data != 0) {
                        var html = "";
                        var datajson = JSON.parse(data);
                        var i = 0;
                        datajson.forEach(function (entry) {
                            i += parseInt(entry.quantity);
                        });
                        $(".div-li-3 a").html("View cart(" + i + ")");
                        $(".view-cart-mobile a").html("View cart(" + i + ")");
                        location.reload();
                    }
                }
            );
        } else {
            removeCart(product_id);
            adddeleteproduct();
        }
    }
}
